# name: Deploy Spring Boot JAR to EC2

# on:
#   push:
#     branches:
#       - main  # Deploy when code is pushed to main branch

# jobs:
#   deploy:
#     name: Deploy & Restart JAR on EC2
#     runs-on: ubuntu-latest

#     steps:
#       - name: ✅ Checkout Repository
#         uses: actions/checkout@v4

#       - name: 🔍 Verify Files Exist
#         run: ls -la ${{ github.workspace }}  # Debugging step to ensure correct directory

#       - name: 🔧 Set up JDK 21
#         uses: actions/setup-java@v4
#         with:
#           java-version: '21'
#           distribution: 'temurin'
#           cache: maven

#       - name: 🏗️ Build with Maven
#         run: mvn clean package -DskipTests

#       - name: 🚀 Upload & Restart JAR on EC2
#         uses: appleboy/scp-action@master
#         with:
#           host: ${{ secrets.HOST_DNS }}
#           username: ${{ secrets.USERNAME }}
#           key: ${{ secrets.EC2_SSH_KEY }}
#           source: "target/SeniorProject-0.0.1-SNAPSHOT.jar"
#           target: "/home/ec2-user/app"
#           script: |
#            # Navigate to the app directory
#             cd /home/ec2-user/app/target
            
#             # Kill any running Java processes
#             sudo pkill -f "java -jar" || echo "No existing process found"

#             # Start the application properly in the background
#             nohup java -jar SeniorProject-0.0.1-SNAPSHOT.jar > app.log 2>&1 & disown
            
#             echo "✅ Spring Boot application restarted successfully!"

